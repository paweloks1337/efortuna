<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ§¾ Lista KuponÃ³w - Mistrzostwa Discorda</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{--gold:#FFD700;--dark:#111;--green:#00FF88}
body{margin:0;font-family:'Poppins',sans-serif;background:linear-gradient(180deg,#000,#111);color:var(--gold);text-align:center}
nav{background:#111;padding:14px 0}
nav a{color:var(--gold);text-decoration:none;margin:0 16px;font-weight:600}
h1{margin:18px 0}

.container{width:90%;max-width:860px;margin:24px auto;background:#1a1a1a;padding:16px;border-radius:14px;text-align:left}
table{width:100%;border-collapse:separate;border-spacing:0 6px}
th,td{padding:10px 14px}
th{color:var(--gold);text-transform:uppercase;font-size:.9rem}
td.nick{color:#fff;font-weight:600}
td.points{color:var(--green);text-align:center;font-weight:700}
td.link button{background:var(--gold);border:none;padding:6px 10px;border-radius:6px;font-weight:600;cursor:pointer}

.sort-box{margin:12px auto}
.sort-box select{background:#111;border:1px solid var(--gold);color:var(--gold);padding:6px 10px;border-radius:8px}

#loader{position:fixed;left:50%;top:50%;width:70px;height:70px;border-radius:50%;border:8px solid rgba(255,215,0,.2);border-top:8px solid var(--gold);transform:translate(-50%,-50%);animation:spin 1s linear infinite}
#loader.hidden{display:none}
@keyframes spin{100%{transform:translate(-50%,-50%) rotate(360deg)}}
</style>
</head>

<body>
<div id="loader"></div>

<nav>
  <a href="/">ğŸ† Ranking</a>
  <a href="/kalkulator">ğŸ“Š Kalkulator</a>
  <a href="/kupony">ğŸ§¾ Lista KuponÃ³w</a>
  <a href="/zasady">ğŸ“– Zasady</a>
</nav>

<h1>ğŸ§¾ Lista KuponÃ³w</h1>

<div class="sort-box">
  <label>ğŸ“… Wybierz miesiÄ…c:</label>
  <select id="month-select">
    <option value="luty" selected>Luty</option>
    <option value="styczen">StyczeÅ„</option>
    <option value="grudzien">GrudzieÅ„</option>
  </select>
</div>

<div id="coupons-container"></div>

<script>
const CSV_URLS = {
  luty: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQodqUqlWT0Ddd8ch_t3Jm7NzRmkrp_qyoP3KTz5gMw3exgx41WL7zcVrDvtQop7niDpeuyM57vaO9n/pub?output=csv",
  styczen: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQqEDjk5U_Kmb9OWYXxvh5w-r3zFzSeruPQEHNOtvhlUFNb7y3bs9LH5doyNSQ3VIADACqs3pkSxLsO/pub?output=csv",
  grudzien: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9Zon74G75eqPkoElWkzBQuOTkG0zSL9bPzic_hdBZT3e0dMXnMBWAwCyu-tRpHxct203uZqQAoww0/pub?output=csv"
};

function parseCSV(t){
  return t.trim().split(/\r?\n/).map(r =>
    r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c => c.replace(/^"|"$/g,''))
  );
}

async function loadCoupons(month){
  document.getElementById("loader").classList.remove("hidden");
  const res = await fetch(CSV_URLS[month]);
  const txt = await res.text();
  const rows = parseCSV(txt);
  const head = rows[0].map(h=>h.toLowerCase());

  const iNick=head.findIndex(h=>h.includes("nick"));
  const iPts=head.findIndex(h=>h.includes("punk"));
  const iDate=head.findIndex(h=>h.includes("data"));
  const iLink=head.findIndex(h=>h.includes("link"));

  const byDate = {};

  rows.slice(1).forEach(r=>{
    const date=(r[iDate]||"â€”").trim();
    if(!byDate[date]) byDate[date]=[];
    byDate[date].push({
      nick:(r[iNick]||"").trim(),
      points:parseFloat((r[iPts]||0).replace(",","."))||0,
      link:(r[iLink]||"#").trim()
    });
  });

  const dates = Object.keys(byDate).sort((a,b)=>{
    const [da,ma,ya]=a.split(".");
    const [db,mb,yb]=b.split(".");
    return new Date(`${yb}-${mb}-${db}`) - new Date(`${ya}-${ma}-${da}`);
  });

  const container=document.getElementById("coupons-container");
  container.innerHTML="";

  dates.forEach(d=>{
    const box=document.createElement("div");
    box.className="container";
    box.innerHTML=`
      <h2>ğŸ“… ${d}</h2>
      <table>
        <thead><tr><th>Nick</th><th>Punkty</th><th>Kupon</th></tr></thead>
        <tbody></tbody>
      </table>`;
    const tbody=box.querySelector("tbody");

    byDate[d].forEach(c=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td class="nick">${c.nick}</td>
        <td class="points">${c.points.toFixed(0)}</td>
        <td class="link"><button onclick="window.open('${c.link}','_blank')">OtwÃ³rz</button></td>`;
      tbody.appendChild(tr);
    });

    container.appendChild(box);
  });

  document.getElementById("loader").classList.add("hidden");
}

document.getElementById("month-select").addEventListener("change", e=>{
  loadCoupons(e.target.value);
});

window.addEventListener("load", ()=>loadCoupons("luty"));
</script>
</body>
</html>
