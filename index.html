<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèÜ Ranking Mistrzostw Discorda</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #FFD700;
  --black: #111;
  --dark: #1a1a1a;
  --light: #f4f4f4;
  --green: #00FF88;
}

body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(180deg, #000, #111 80%);
  color: var(--gold);
  margin: 0;
  padding: 0;
  text-align: center;
  transition: background 0.5s, color 0.5s;
}

body.light-mode {
  background: linear-gradient(180deg, #fff, #ddd);
  color: #222;
}

/* Menu */
nav {
  background: linear-gradient(90deg, #000, #222);
  padding: 15px 0;
  box-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
}
nav a {
  color: var(--gold);
  text-decoration: none;
  margin: 0 20px;
  font-weight: 600;
  font-size: 1.1em;
  transition: 0.3s;
}
nav a:hover {
  color: white;
  text-shadow: 0 0 10px var(--gold);
}

/* Tryb jasny/ciemny */
.theme-toggle {
  position: absolute;
  top: 20px;
  right: 20px;
  background: transparent;
  border: 2px solid var(--gold);
  color: var(--gold);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  cursor: pointer;
  font-size: 1.2em;
  transition: 0.3s;
}
.theme-toggle:hover {
  background: var(--gold);
  color: #000;
}

/* Kontener */
.container {
  background: var(--dark);
  margin: 40px auto;
  padding: 25px;
  border-radius: 15px;
  width: 90%;
  max-width: 800px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.5);
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 1s ease, transform 1s ease;
}
.show {
  opacity: 1 !important;
  transform: translateY(0) !important;
}
body.light-mode .container {
  background: white;
  color: #000;
}

/* Loader */
.loader {
  border: 6px solid #333;
  border-top: 6px solid var(--gold);
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
  margin: 40px auto;
}
@keyframes spin {
  100% { transform: rotate(360deg); }
}

/* Tabela */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}
th, td {
  padding: 10px;
  border-bottom: 1px solid #444;
}
th {
  background: #222;
  color: var(--gold);
}
body.light-mode th {
  background: #eee;
  color: #000;
}
td:nth-child(2) { color: white; } /* Nick */
td:nth-child(4) { color: #00ff00; font-weight: 600; } /* Punkty */

/* Wyszukiwarka */
.search-box {
  margin-top: 15px;
  padding: 10px;
  width: 80%;
  border: 2px solid var(--gold);
  border-radius: 8px;
  background: #000;
  color: var(--gold);
  font-size: 1em;
}
body.light-mode .search-box {
  background: #fff;
  color: #000;
  border-color: #444;
}

footer {
  margin-top: 40px;
  padding: 15px;
  font-size: 0.9em;
  color: #aaa;
}
</style>
</head>
<body>

<nav>
  <a href="index.html">üèÜ Ranking</a>
  <a href="kalkulator.html">üìä Kalkulator</a>
</nav>

<button class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è</button>

<h1>üèÜ Mistrzostwa Typowania Discorda 2025</h1>
<input type="text" id="search" class="search-box" placeholder="üîç Szukaj nicku...">

<div class="loader" id="loader"></div>

<div class="container" id="ranking-box" style="display:none;">
  <table id="rankingTable">
    <thead>
      <tr><th>Miejsce</th><th>Nick</th><th>Kupony</th><th>Punkty</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<footer>
  ¬© 2025 Mistrzostwa Discorda | Stworzone przez Paw≈Ça ‚öΩ
</footer>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTThQFcv-8JkvXEePVWkQw7yoEJX9XcZDFCChCWL_JmzgLQItyNW5qmp2eUKxD6a5Wp--sfWzFes_Cj/pub?output=csv";

async function loadRanking() {
  const loader = document.getElementById("loader");
  const box = document.getElementById("ranking-box");
  const tableBody = document.querySelector("#rankingTable tbody");

  try {
    const res = await fetch(CSV_URL);
    const text = await res.text();

    // üîß automatyczne wykrywanie separatora ("," lub ";")
    const separator = text.includes(";") ? ";" : ",";
    const rows = text.trim().split("\n").map(r => r.split(separator));

    // üî• znajd≈∫ indeksy kolumn
    const header = rows[0].map(h => h.trim().toLowerCase());
    const nickCol = header.findIndex(h => h.includes("nick"));
    const punktyCol = header.findIndex(h => h.includes("punkt"));

    if (nickCol === -1 || punktyCol === -1) {
      loader.textContent = "Nie znaleziono kolumn Nick / Punkty üòï";
      return;
    }

    const ranking = {};

    rows.slice(1).forEach(row => {
      const nick = row[nickCol]?.trim();
      const punkty = parseFloat(row[punktyCol]?.replace(",", "."));
      if (!nick || isNaN(punkty)) return;
      if (!ranking[nick]) ranking[nick] = { kupony: 0, punkty: 0 };
      ranking[nick].kupony++;
      ranking[nick].punkty += punkty;
    });

    const sorted = Object.entries(ranking).sort((a, b) => b[1].punkty - a[1].punkty);

    tableBody.innerHTML = "";
    sorted.forEach(([nick, data], i) => {
      const row = document.createElement("tr");
      row.innerHTML = `<td>${i + 1}</td><td>${nick}</td><td>${data.kupony}</td><td>${data.punkty.toFixed(0)}</td>`;
      tableBody.appendChild(row);
    });

    loader.style.display = "none";
    box.style.display = "block";
    box.classList.add("show");

  } catch (err) {
    loader.textContent = "‚ùå B≈ÇƒÖd podczas ≈Çadowania danych: " + err.message;
  }
}

function toggleTheme() {
  document.body.classList.toggle("light-mode");
  const btn = document.querySelector(".theme-toggle");
  btn.textContent = document.body.classList.contains("light-mode") ? "üåô" : "‚òÄÔ∏è";
}

// Filtr wyszukiwania
document.getElementById("search").addEventListener("input", function() {
  const value = this.value.toLowerCase();
  document.querySelectorAll("#rankingTable tbody tr").forEach(tr => {
    tr.style.display = tr.children[1].textContent.toLowerCase().includes(value) ? "" : "none";
  });
});

window.addEventListener("load", loadRanking);
</script>
</body>
</html>
